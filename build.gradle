plugins {
    id 'java'
    id 'org.jetbrains.intellij' version '1.8.0'
}

group 'jp.kitabatakep'
version '2022.2.0'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    testImplementation group: 'junit', name: 'junit', version: '4.13.2'
}

// See https://github.com/JetBrains/gradle-intellij-plugin/
intellij {
    version.set('2022.2')
}

//runIde {
//    ideDirectory '/Applications/RubyMine.app/Contents'
//}

// patch of https://youtrack.jetbrains.com/issue/KTIJ-782
tasks.buildSearchableOptions {
    enabled = false
}

// activate logging of deprecated API usage:
//tasks.withType(JavaCompile) {
//    options.compilerArgs << "-Xlint:deprecation"
//}

patchPluginXml {
    def stripTag = { text, tag -> text.replace("<${tag}>", "").replace("</${tag}>", "") }
    def bodyInnerHTML = { path ->
        stripTag(stripTag(file(path).text, "html"), "body")
    }

    pluginDescription.set(provider{ bodyInnerHTML("src/main/resources/META-INF/description.html") })
    changeNotes.set(provider{ bodyInnerHTML("src/main/resources/META-INF/changeNotes.html") } )
}